var __reflect=this&&this.__reflect||function(e,t,r){e.__class__=t,r?r.push(t):r=[t],e.__types__=e.__types__?r.concat(e.__types__):r},__extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},__awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{c(n.next(e))}catch(t){i(t)}}function s(e){try{c(n["throw"](e))}catch(t){i(t)}}function c(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,s)}c((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(a=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(i,r[1])).done)return a;switch(i=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,i=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){c=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){c.label=r[1];break}if(6===r[0]&&c.label<a[1]){c.label=a[1],a=r;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(r);break}a[2]&&c.ops.pop(),c.trys.pop();continue}r=t.call(e,c)}catch(n){r=[6,n],i=0}finally{o=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,i,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,r){function n(n){t.call(r,n,e)}if(RES.hasRes(e)){var o=RES.getRes(e);o?n(o):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t,r;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return n.sent(),this.stage.removeChild(e),t=new Game,this.stage.addChild(t),[3,5];case 4:return r=n.sent(),console.error(r),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,r){var n=new eui.Theme("resource/default.thm.json",e.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,r,n){function o(e){t.call(n,e)}function i(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),r.call(n))}var a=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(n,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,r){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(n,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var s=e.split("/");s.pop();var c=s.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(n,generateJSON.paths[e])},this):RES.getResByUrl(c,function(r){window.JSONParseClass.setData(r),egret.callLater(function(){t.call(n,generateJSON.paths[e])},a)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(n,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var config={gameGroup:{PLAYER:Math.pow(2,1),ENEMY:Math.pow(2,2),GROUND:Math.pow(2,3)}},Game=function(e){function t(){var t=e.call(this)||this;return t.time=0,t.skinName="gameComponent",t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.worldInit()},t.prototype.playAnimation=function(e,t){if(t)for(var r in e.items)e.items[r].props={loop:!0};e.play()},t.prototype.worldInit=function(){var e=this;this.playAnimation(this.cloud,!0),this.material1=new p2.Material(1),this.material2=new p2.Material(2);var t=50,r=new p2.World({gravity:[0,-.5]}),n=new p2.ContactMaterial(this.material1,this.material2);n.friction=1,n.restitution=.1,r.addContactMaterial(n),this.createGround(r,this,1,0,10,1334,"wall_png",5,667),this.createGround(r,this,2,0,750,10,"wall_png",375,1329),this.createGround(r,this,3,0,10,1334,"wall_png",745,667),this.createGround(r,this,4,0,750,10,"wall_png",375,5),egret.startTick(function(n){var o=n,i=e.time,a=o-i;if(e.time=o,!(10>a||a>1e3)){r.step(a/1e3);for(var s=egret.MainContext.instance.stage.stageHeight,c=r.bodies.length,l=0;c>l;l++){var h=r.bodies[l],u=h.displays[0];u&&(u.x=h.position[0]*t,u.y=s-h.position[1]*t,u.rotation=360-180*(h.angle+h.shapes[0].angle)/Math.PI,h.sleepState==p2.Body.SLEEPING?u.alpha=.5:u.alpha=1)}return!1}},this),this.hero=new Role(this,375,600,1,1),r.addBody(this.hero),this.hero.shapes[0].material=this.material2;var o=new Role(this,200,600,0,1);r.addBody(o),this.upControl.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var r=p2.vec2.fromValues(0,50);e.hero.applyForce(r,[0,0])},this),this.leftControl.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var r=p2.vec2.fromValues(-100,0);e.hero.applyForce(r,[0,0]),e.hero.displays[0].scaleX=1},this),this.rightControl.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var r=p2.vec2.fromValues(100,0);e.hero.applyForce(r,[0,0]),e.hero.displays[0].scaleX=-1},this)},t.prototype.createGround=function(e,t,r,n,o,i,a,s,c){var l=new p2.Body({mass:1,fixedRotation:!0,position:PhysicsTool.convertToPhysicsPos(s,c),type:p2.Body.STATIC,velocity:[n,0]});l.id=r,console.log("位置：",l.position),e.addBody(l);var h=new p2.Box({width:PhysicsTool.convertToPhysicsLength(o),height:PhysicsTool.convertToPhysicsLength(i)});l.addShape(h);var u=this.createBitmapByName(a);return u.width=o,u.height=i,u.anchorOffsetX=o/2,u.anchorOffsetY=i/2,l.displays=[u],t.addChild(u),h.material=this.material1,l},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,r=RES.getRes(e);return t.texture=r,t},t.prototype.createBall=function(e){var t=new egret.Shape;return t.graphics.beginFill(16773120),t.graphics.drawCircle(0,0,e),t.graphics.endFill(),t},t}(eui.Component);__reflect(Game.prototype,"Game");var Role=function(e){function t(t,r,n,o,i){var a=e.call(this,{mass:1,fixedRotation:!0})||this;return a.roleType=o,a.container=t,a.balloonCount=i,a.position=PhysicsTool.convertToPhysicsPos(r,n),a.createShape(),a}return __extends(t,e),t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,r=RES.getRes(e);return t.texture=r,t},t.prototype.createShape=function(){var e,t=this;0==this.roleType?(e="enemy1_png",this.group=config.gameGroup.ENEMY):1==this.roleType&&(e="role_png",this.group=config.gameGroup.PLAYER);var r=this.createBitmapByName(e),n=new p2.Box({width:PhysicsTool.convertToPhysicsLength(r.width),height:PhysicsTool.convertToPhysicsLength(r.height)});this.addShape(n),this.displays=[r],this.container.addChild(r),r.anchorOffsetX=r.width/2,r.anchorOffsetY=r.height/2,0==this.roleType&&setInterval(function(){if(t.velocity[1]<0){var e=50*Math.random()+50,r=p2.vec2.fromValues(0,e);t.applyForce(r,[0,0])}},2e3)},t.prototype.autoAttack=function(){var e=3*Math.random()-1.5,t=3*Math.random()-1.5,r=p2.vec2.fromValues(e,t);this.applyForce(r,[0,0])},t}(p2.Body);__reflect(Role.prototype,"Role");var PhysicsTool=function(){function e(){}return e.convertToPhysicsPos=function(e,t){return[e/this.factor,(egret.MainContext.instance.stage.stageHeight-t)/this.factor]},e.convertToPhysicsLength=function(e){return Math.floor(e/this.factor)},e.factor=50,e}();__reflect(PhysicsTool.prototype,"PhysicsTool");